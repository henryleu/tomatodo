<% layout('boilerplate') -%>
<script>
    window.tomatocache = {
        setting:{
            tomotoTime: '25m',
            breakTime: '5m'
        },
        user: {
            tomotoTime: '25m',
            breakTime: '5m'
        }
    };
    $(document).ready(function(){
        var tomatoCountdown = new countdown({
            id: 'tomatoCountdown',
            counter: 'counter',
            timeout: '25m',
            step: '1s',
            refreshCallback: function(){},
            stepCallback: function(){$('#progress').css('width', (100-this.getProgress())+'%');},
            startCallback: function(){
                $('#'+this.counter).removeClass('stopped').addClass('running');
                $('.progress').addClass('progress-striped').removeClass('progress-stopped');
                $('#progress').css('width', '100%');
                $('#tomatoBtn').removeAttr("disabled").html('停止快跑');
                $('#breakBtn').attr('disabled',"true");
            },
            finishCallback: function(){
                $('#'+this.counter).removeClass('running').addClass('stopped');
                $('#progress').css('width', '0%');
                $('#tomatoBtn').removeAttr("disabled").html('开始快跑');
                $('#breakBtn').removeAttr("disabled");
                //TODO: prompt user
            },
            killCallback: function(){
                $('#'+this.counter).removeClass('running').addClass('stopped');
                $('.progress').removeClass('progress-striped').addClass('progress-stopped');
                $('#tomatoBtn').removeAttr("disabled").html('开始快跑');
                $('#breakBtn').removeAttr("disabled");
            }
        });
        tomatoCountdown.reset();

        var breakCountdown = new countdown({
            id: 'breakCountdown',
            counter: 'counter',
            timeout: '5m',
            step: '1s',
            refreshCallback: function(){},
            stepCallback: function(){$('#progress').css('width', (100-this.getProgress())+'%');},
            startCallback: function(){
                $('#'+this.counter).removeClass('stopped').addClass('running');
                $('.progress').addClass('progress-striped').removeClass('progress-stopped');
                $('#progress').css('width', '100%');
                $('#tomatoBtn').attr('disabled',"true");
                $('#breakBtn').removeAttr("disabled").html('停止休息');
            },
            finishCallback: function(){
                $('#'+this.counter).removeClass('running').addClass('stopped');
                $('#tomatoBtn').removeAttr("disabled").html('开始快跑');
                $('#breakBtn').removeAttr("disabled").html('开始休息');
            },
            killCallback: function(){
                $('#'+this.counter).removeClass('running').addClass('stopped');
                $('.progress').removeClass('progress-striped').addClass('progress-stopped');
                $('#tomatoBtn').removeAttr("disabled").html('开始快跑');
                $('#breakBtn').removeAttr("disabled").html('开始休息');
            }
        });

        $('#tomatoBtn').click(function(){
            if( tomatoCountdown.getStatus()=='finished' || tomatoCountdown.getStatus()=='stopped' || tomatoCountdown.getStatus()=='killed' ){
                tomatoCountdown.reset();
                tomatoCountdown.start();
            }
            else if( tomatoCountdown.getStatus()=='running'){
                tomatoCountdown.kill();
            }
        });
        $('#breakBtn').click(function(){
            if( breakCountdown.getStatus()=='finished' || breakCountdown.getStatus()=='stopped' || breakCountdown.getStatus()=='killed' ){
                breakCountdown.reset();
                breakCountdown.start();
            }
            else if( breakCountdown.getStatus()=='running'){
                breakCountdown.kill();
            }
        });
    });
</script>
<br><br><br><br><br>
<style>
    .running {color: #3C8CFF;}
    .stop {color: gray;}
    .remainTime{
        text-align:center;
        font-size:160px;
        line-height:1.2;
    }
    .task{
        display: block;
        margin: auto;
        height: 20px;
        width: 400px;
        padding: 20px 15px;
        font-weight: bold;
        text-align: left;
    }
</style>
<div class="container-fluid">
    <div id="test" ></div>
<div class="row-fluid">
    <div class="offset3 span6">
        <div id="counter" class="remainTime"></div>
    </div>
</div>
<div class="row-fluid">
    <div class="offset3 span6">
        <div class="progress progress-striped active">
            <div id="progress" class="bar" style="width: 0%;"></div>
        </div>
    </div>
</div>
<div class="row-fluid">
    <div class="offset3 span4 nopadding">
        <textarea id="tomato-task" rows="2" title="请输入任务..." placeholder="请输入任务..." class="task" style="margin: 0px 77px 0px 0px; width: 406px; height: 21px;"></textarea>
    </div>
    <div class="span2">
        <button id="tomatoBtn" class="btn btn-large btn-block btn-primary">开始快跑</button>
    </div>
</div>
<div class="row-fluid">&nbsp;</div>
<div class="row-fluid">
    <div class="offset3 span4">
        <div class="btn-group pull-right" data-toggle="button-checkbox">
            <button class="btn btn-large active">活动身体</button>
            <button class="btn btn-large active">WC</button>
            <button class="btn btn-large active">喝水</button>
            <button class="btn btn-large active">工作回顾</button>
            <button class="btn btn-large">其他</button>
        </div>
    </div>
    <div class="span2">
        <button id="breakBtn" class="btn btn-large btn-block btn-warning">开始休息</button>
    </div>
</div>


</div>