<% layout('boilerplate') -%>
< script( '/tomatodo/js/tomatodo.js') ->
< stylesheet('/tomatodo/css/tomatodo.css') ->
<script>
    window.tomato = {};
    var countdown = function(o){
        var me = this;
        if(!o){
            throw new Error('need options argument');
        }
        me.o = o;
        me.id = o.id;
        me.counter = o.counter; // HTML container of countdown timer board
        me.unit = String( o.timeout).charAt( o.timeout.length-1 );
        var _timeout = parseInt( o.timeout );
        if(me.unit=='s'){
            me.timeout = _timeout*1000;
            me.timeoutUnit = _timeout;
        }
        else if(me.unit=='m'){
            me.timeout = _timeout*60*1000;
            me.timeoutUnit = _timeout*60;
        }
        else if(me.unit=='h'){
            me.timeout = _timeout*60*60*1000;
            me.timeoutUnit = _timeout*60*60;
        }
        else{
            throw new Error('"unit" argument should be like "10s", "10m" or "1h"');
        }
        me.passedUnit = 0;
        me.leftUnit = me.timeoutUnit;

//alert( me.timeoutUnit + " : " + me.passedUnit + " : " + me.leftUnit );
        // refresh per second
        // //TODO: assume unit is second for show
        var refreshInterval = 300;
        var showFn = function(){

        };
        var refreshFn = function(){
            var passed = $.timer(me.id).getPassedTime();
            var left = me.timeout-passed;
            me.passed = passed;
            me.left = left;

            //TODO: assume unit is second for show
            me.passedUnit = Math.round( passed/1000 );
            var leftUnit = me.timeoutUnit - me.passedUnit;

           // $( '#'+me.counter).html( passed/1000 + ' - ' + me.passedUnit);
            if(leftUnit!=me.leftUnit){
                me.leftUnit = leftUnit;
                $( '#'+me.counter).html( me.leftUnit );
            }
            else{

            }
        };
        var timeoutFn = function(){
            //alert( me.timeout + " : " + me.passed + " : " + me.left );

            //refreshFn();
        };

        $.timer( me.id, refreshFn, refreshInterval, {
            timeout: me.timeout,
            finishCallback: timeoutFn
        });
        me.timer = $.timer(me.id);
    };
    tomato.countdown = countdown;
    countdown.prototype.start = function(){
        this.timer.start();
    };
    countdown.prototype.stop = function(){
        this.timer.stop();
    };

    $(document).ready(function(){
        var tomatoCountdown = new tomato.countdown(
            {
                id: 'counter',
                timeout: '5s',
                counter: 'counter1'
            }
        );
        //tomatoCountdown.start();

        var pad0 = function (num, size) {
            var s = num+"";
            while (s.length < size) s = "0" + s;
            return s;
        }
        var pad1 = function (num, size) {
            var s = "000000000" + num;
            return s.substr(s.length-size);
        }

        var pad2 = function (num, places) {
            var zero = places - num.toString().length + 1;
            return Array(+(zero > 0 && zero)).join("0") + num;
        }

        var pad3 = function(
                a, // the number to convert
                b // number of resulting characters
                ){
            return (
                    [ 1e15 ] + a // combine with large number
                    ).slice(-b) // cut leading "1"
        };
        
        var startTime = null;
        var endTime = null;

        /*
            pad 0
         */
        var pad0Cost = null;
        startTime = new Date().getTime();
        for(var i=0; i < 100000; i++){
            pad0(2,2);
        }
        endTime = new Date().getTime();
        pad0Cost = endTime -startTime;
        $( '#pad0').html('pad0 = '+ pad0Cost );

        /*
         pad 1
         */
        var pad1Cost = null;
        startTime = new Date().getTime();
        for(var i=0; i < 100000; i++){
            pad1(2,10);
        }
        endTime = new Date().getTime();
        pad1Cost = endTime -startTime;
        $( '#pad1').html('pad1 = '+ pad1Cost );

        /*
         pad 2
         */
        var pad2Cost = null;
        startTime = new Date().getTime();
        for(var i=0; i < 100000; i++){
            pad2(2,10);
        }
        endTime = new Date().getTime();
        pad2Cost = endTime -startTime;
        $( '#pad2').html('pad2 = '+ pad2Cost );


        /*
         pad 3
         */
        var pad3Cost = null;
        startTime = new Date().getTime();
        for(var i=0; i < 100000; i++){
            pad3(2,10);
        }
        endTime = new Date().getTime();
        pad3Cost = endTime -startTime;
        $( '#pad3').html('pad3 = '+ pad3Cost );

        $( '#padrcopare').html('padrcopare = '+ (pad2Cost/pad1Cost) );

/*
        $.timer(
            'new_tomato',
            function() {
                //alert('dsaf');
                $('#counter').val( $.timer('new_tomato').getPassedTime() );
            },
            1000,
            {
                timeout: 5000,
                finishCallback: function(){ alert('Finished!') }
            }
        );
        $.timer('new_tomato').start();
*/
    });
</script>
<br><br><br><br><br>
        sdf
<div id="counter1">asfd
</div>

<br>
<div id="pad0"></div>

<br>
<div id="pad1"></div>

<br>
<div id="pad2"></div>
<br>
<div id="pad3"></div>

<br>
<div id="padrcopare"></div>
